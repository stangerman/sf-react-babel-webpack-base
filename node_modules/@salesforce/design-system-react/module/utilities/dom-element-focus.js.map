{"version":3,"sources":["../../.tmp-es/utilities/dom-element-focus.js"],"names":["findTabbableElement","KEYS","canUseDOM","ancestor","focusLaterElement","handleScopedKeyDown","event","keyCode","TAB","tabbableElements","finalTabbable","shiftKey","length","leavingFinalTabbable","document","activeElement","preventDefault","target","focus","ElementFocus","focusAncestor","hasOrAncestorHasFocus","contains","returnFocusToStoredElement","e","console","warn","setupScopedFocus","ancestorElement","window","addEventListener","storeActiveElement","teardownScopedFocus","removeEventListener"],"mappings":"AAAA,OAAOA,mBAAP,MAAgC,YAAhC;AACA,OAAOC,IAAP,MAAiB,YAAjB;AACA,SAASC,SAAT,QAA0B,yBAA1B;AAEA,IAAIC,WAAW,IAAf;AACA,IAAIC,oBAAoB,IAAxB;;AAEA,IAAMC,sBAAsB,SAAtBA,mBAAsB,CAACC,KAAD,EAAW;AACtC,MAAI,CAACJ,SAAD,IAAc,CAACC,QAAf,IAA2BG,MAAMC,OAAN,KAAkBN,KAAKO,GAAtD,EAA2D;AAC1D;AACA;;AACD,MAAMC,mBAAmBT,oBAAoBG,QAApB,CAAzB;AACA,MAAMO,gBACLD,iBAAiBH,MAAMK,QAAN,GAAiB,CAAjB,GAAqBF,iBAAiBG,MAAjB,GAA0B,CAAhE,CADD;AAEA,MAAMC,uBACLH,kBAAkBI,SAASC,aAA3B,IACA;AACAZ,eAAaW,SAASC,aAHvB;AAIA,MAAI,CAACF,oBAAL,EAA2B;AAC3BP,QAAMU,cAAN;AACA,MAAMC,SACLR,iBAAiBH,MAAMK,QAAN,GAAiBF,iBAAiBG,MAAjB,GAA0B,CAA3C,GAA+C,CAAhE,CADD;AAEAK,SAAOC,KAAP;AACA,CAhBD,C,CAkBA;;;AAEA,IAAMC,eAAe;AACpBC,iBAAe,yBAAM;AACpB,QAAIlB,SAAJ,EAAe;AACdC,eAASe,KAAT;AACA;AACD,GALmB;AAMpBG,yBAAuB;AAAA,WACtBnB,cACCY,SAASC,aAAT,KAA2BZ,QAA3B,IACAA,SAASmB,QAAT,CAAkBR,SAASC,aAA3B,CAFD,CADsB;AAAA,GANH;AAUpBQ,8BAA4B,sCAAM;AACjC,QAAIrB,SAAJ,EAAe;AACd,UAAI;AACHE,0BAAkBc,KAAlB;AACA,OAFD,CAEE,OAAOM,CAAP,EAAU;AACX;AACAC,gBAAQC,IAAR,wCACiCtB,iBADjC;AAGA;;AACDA,0BAAoB,IAApB;AACA;AACD,GAtBmB;AAuBpBuB,oBAAkB,gCAAyB;AAAA,QAAtBC,eAAsB,QAAtBA,eAAsB;AAC1CzB,eAAWyB,eAAX;AACAC,WAAOC,gBAAP,CAAwB,SAAxB,EAAmCzB,mBAAnC,EAAwD,KAAxD;AACA,GA1BmB;AA2BpB0B,sBAAoB,8BAAM;AACzB3B,wBAAoBF,YAAYY,SAASC,aAArB,GAAqC,IAAzD;AACA,GA7BmB;AA8BpBiB,uBAAqB,+BAAM;AAC1B7B,eAAW,IAAX;;AACA,QAAID,SAAJ,EAAe;AACd2B,aAAOI,mBAAP,CAA2B,SAA3B,EAAsC5B,mBAAtC;AACA;AACD;AAnCmB,CAArB;AAsCA,eAAec,YAAf","sourcesContent":["import findTabbableElement from './tabbable';\nimport KEYS from './key-code';\nimport { canUseDOM } from './execution-environment';\n\nlet ancestor = null;\nlet focusLaterElement = null;\n\nconst handleScopedKeyDown = (event) => {\n\tif (!canUseDOM || !ancestor || event.keyCode !== KEYS.TAB) {\n\t\treturn;\n\t}\n\tconst tabbableElements = findTabbableElement(ancestor);\n\tconst finalTabbable =\n\t\ttabbableElements[event.shiftKey ? 0 : tabbableElements.length - 1];\n\tconst leavingFinalTabbable =\n\t\tfinalTabbable === document.activeElement ||\n\t\t// handle immediate shift+tab after opening with mouse\n\t\tancestor === document.activeElement;\n\tif (!leavingFinalTabbable) return;\n\tevent.preventDefault();\n\tconst target =\n\t\ttabbableElements[event.shiftKey ? tabbableElements.length - 1 : 0];\n\ttarget.focus();\n};\n\n// PUBLIC methods\n\nconst ElementFocus = {\n\tfocusAncestor: () => {\n\t\tif (canUseDOM) {\n\t\t\tancestor.focus();\n\t\t}\n\t},\n\thasOrAncestorHasFocus: () =>\n\t\tcanUseDOM &&\n\t\t(document.activeElement === ancestor ||\n\t\t\tancestor.contains(document.activeElement)),\n\treturnFocusToStoredElement: () => {\n\t\tif (canUseDOM) {\n\t\t\ttry {\n\t\t\t\tfocusLaterElement.focus();\n\t\t\t} catch (e) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`You tried to return focus to ${focusLaterElement} but it is not in the DOM anymore`\n\t\t\t\t);\n\t\t\t}\n\t\t\tfocusLaterElement = null;\n\t\t}\n\t},\n\tsetupScopedFocus: ({ ancestorElement }) => {\n\t\tancestor = ancestorElement;\n\t\twindow.addEventListener('keydown', handleScopedKeyDown, false);\n\t},\n\tstoreActiveElement: () => {\n\t\tfocusLaterElement = canUseDOM ? document.activeElement : null;\n\t},\n\tteardownScopedFocus: () => {\n\t\tancestor = null;\n\t\tif (canUseDOM) {\n\t\t\twindow.removeEventListener('keydown', handleScopedKeyDown);\n\t\t}\n\t},\n};\n\nexport default ElementFocus;\n"],"file":"dom-element-focus.js"}